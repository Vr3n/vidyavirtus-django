{% extends 'base.html' %}

{% block content %}
<section class="my-2">
  <!-- end Heading -->
  <h2 class="text-2xl font-bold">Hello, Viren Patel</h2>
  <!-- end Heading -->

  <c-card class="mt-2">
    <div class="flex justify-between gap-4 mb-4">
      <div>
        <h2 class="text-xl">Your Job Shortlists</h2>
        <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">
          View, Edit, Update, Filter your shortlists. Simple view for job shortlists.
        </p>
      </div>
      <div class="flex">
        <c-button.primary custom_class="inline-block"
          data-drawer-target="add_new_shortlist_drawer"
          data-drawer-show="add_new_shortlist_drawer"
          data-drawer-placement="bottom"
          data-drawer-backdrop="false"
          aria-controls="add_new_shortlist_drawer"
         >
          Add new job shortlist
        </c-button.primary>
        <c-button.outline>
          Schedule interview
        </c-button>
      </div>
    </div>
    <div class="relative overflow-x-auto">
      {% include 'partials/job_shortlist_table.html' %}
    </div>
    <div x-data="{ 
      'search': '',
      'open': false,
      'selected_value': '' ,
      toggle () { 
        if (this.search.length >= 1) {
          this.open = true;
        } else {
          this.open = false;
          this.selected_value = null;
          document.querySelector('#company_id').value = this.selected_value;
        }
      },
      selectValue (value, name) {
        this.selected_value = value;
        this.search = name;
        this.open = false;
      },
    }">
      <div class="relative max-w-fit">
        <p for="search_company">Search Company</p>
        <input x-model="selected_value" id="company_id" type="hidden" name="company" />
        <input
            type="text" 
            id="search_company"
            name="company_name" 
            x-model="search"
            @keyup.debounce="toggle()"
            @keydown="if ($event.ctrlKey && $event.key === ' ') { !this.open }"
            hx-post="{% url 'hx_company_filter' %}"
            hx-trigger="input changed delay:500ms, search"
            hx-target="#search_results"
            hx-swap="outerHTML"
        />
        <div id="search_results" x-show="open" class="absolute w-full">
        </div>
      </div>
    </div>
  </c-card>
</section>
{% endblock content %}

{% block custom_js %}
<script>
  document.body.addEventListener("company_added", function (evt) {
    let cid = document.getElementById('company_id')
    console.log(evt.detail.id);
    cid.value = evt.detail.id;
  })
</script>
{% endblock custom_js %}

{% block custom_modals %}
<c-sheet id="add_new_shortlist_drawer" header_title="Add New Job">
  <span hx-trigger="intersect" hx-get="{% url 'hx_add_joblist' %}" hx-target="this">
  </span>
</c-sheet>
{% endblock custom_modals %}
